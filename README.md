# Invoice Management System

A comprehensive Django-based invoice and inventory management system with user authentication, product management, and stock tracking.

## Project Metadata

**Project Name:** Invoice Management System  
**Framework:** Django 5.2.7  
**Database:** SQLite (lightweight for all environments)  
**Python Version:** 3.13.2  
**License:** MIT  
**Created:** November 2025  
**Author:** Generated by GitHub Copilot  

## Features

### Core Functionality
- ✅ **User Authentication**: Secure login/logout with password change functionality
- ✅ **User Management**: Admin-only user creation, deletion, password reset, and enable/disable
- ✅ **Forced Password Change**: New users must change default password on first login
- ✅ **Invoice Management**: Create, view, and manage invoices with auto-generated invoice numbers
- ✅ **Product/Inventory Management**: Complete CRUD operations for products (admin creates, all users view)
- ✅ **Stock Movement Tracking**: Incoming and outgoing stock movements with full audit trail
- ✅ **Dynamic Stock Calculation**: Stock = Incoming - Outgoing - Sales (calculated on-the-fly)
- ✅ **Print-Friendly Design**: Clean invoice layout optimized for printing with rupee currency
- ✅ **Admin Filtering**: Filter invoices by user and date range (admin only)
- ✅ **Responsive Design**: Professional interface that works on all devices
- ✅ **IPv6 Support**: Configured for external IPv6 access

### Technical Features
- **Database**: Lightweight SQLite database with automated migrations
- **Security**: CSRF protection, user authorization, forced password changes, staff-only views
- **Currency**: Indian Rupee (₹) symbol throughout
- **Auto-numbering**: Invoice numbers format: INV-YYYYMMDD-XXXX
- **Stock Tracking**: Complete audit trail of all inventory movements
- **Role-Based Access**: Staff/admin vs regular user permissions

## Architecture

### Project Structure
```
invoice/
├── invoice_app/           # Django project settings
│   ├── __init__.py
│   ├── settings.py        # Main configuration (ALLOWED_HOSTS=['*'])
│   ├── urls.py           # URL routing
│   └── wsgi.py           # WSGI configuration
├── invoices/             # Main application
│   ├── migrations/       # Database migrations
│   ├── middleware.py     # Password change enforcement
│   ├── __init__.py
│   ├── admin.py         # Admin interface (Product, Invoice, UserProfile, StockMovement)
│   ├── forms.py         # Forms (Invoice, Product, StockMovement)
│   ├── models.py        # Models (UserProfile, Product, StockMovement, Invoice)
│   ├── urls.py          # App-specific URLs
│   └── views.py         # View functions
├── templates/           # HTML templates
│   ├── base.html        # Base template with navigation
│   ├── registration/    # Authentication templates
│   └── invoices/        # App templates
│       ├── home.html
│       ├── invoice_*.html           # Invoice views
│       ├── product_*.html           # Product management
│       ├── inventory_*.html         # Inventory management
│       ├── user_*.html              # User management
│       └── change_password.html
├── Dockerfile           # Docker configuration
├── docker-compose.yml   # Docker Compose configuration
├── requirements.txt     # Python dependencies
├── db.sqlite3          # SQLite database
└── manage.py           # Django management script
```

### Database Schema

#### UserProfile Model
```python
- user (OneToOneField to User)         # Extended user info
- must_change_password (Boolean)       # Force password change flag
```

#### Product Model
```python
- item_name (CharField, unique)        # Product name
- description (TextField)              # Product description
- unit_of_measure (CharField)          # Unit (pcs, kg, liter, etc.)
- unit_price (DecimalField)           # Price per unit (₹)
- is_active (Boolean)                 # Active status
- created_at (DateTimeField)          # Creation timestamp
- updated_at (DateTimeField)          # Update timestamp
# quantity_in_stock: Calculated property (Incoming - Outgoing - Sales)
```

#### StockMovement Model
```python
- product (ForeignKey to Product)      # Product reference
- movement_type (CharField)            # 'IN' or 'OUT'
- quantity (DecimalField)             # Quantity moved
- movement_date (DateField)           # Date of movement
- notes (TextField)                   # Optional notes
- created_by (ForeignKey to User)     # User who created movement
- created_at (DateTimeField)          # Creation timestamp
```

#### Invoice Model
```python
- user (ForeignKey to User)           # Invoice creator
- client_name (CharField)             # Client name
- invoice_number (CharField, auto)    # INV-YYYYMMDD-XXXX
- invoice_date (DateField)            # Invoice date (defaults to today)
- product (ForeignKey to Product)     # Product sold
- quantity (PositiveIntegerField)     # Quantity sold
- created_at (DateTimeField)          # Creation timestamp
- updated_at (DateTimeField)          # Update timestamp
```

#### Calculated Fields
- `unit_price`: Pulled from product.unit_price
- `subtotal`: quantity × unit_price
- `tax_amount`: subtotal × 0.1 (10% tax)
- `total`: subtotal + tax_amount
- `product.quantity_in_stock`: Sum(IN) - Sum(OUT) - Sum(Invoice quantities)

## Installation & Setup

### Local Development

1. **Clone and Setup**
   ```bash
   git clone <repository-url>
   cd invoice
   python3 -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. **Database Setup**
   ```bash
   python manage.py migrate
   python manage.py createsuperuser  # Create admin account
   ```

3. **Initial Data Setup**
   - Login to admin interface: http://127.0.0.1:8000/admin/
   - Create initial products (name, description, unit, price)
   - Add initial stock via Inventory Management

4. **Run Development Server**
   ```bash
   # Local access only
   python manage.py runserver
   
   # External IPv6 access
   python manage.py runserver 0.0.0.0:8000
   ```

5. **Access Application**
   - Main app: http://127.0.0.1:8000/
   - Admin interface: http://127.0.0.1:8000/admin/
   - External IPv6: http://[YOUR_IPV6_ADDRESS]:8000/

**Important Notes:**
- Default password for admin-created users: `Welcome@123`
- New users must change password on first login
- Products must exist before creating invoices
- Stock quantities calculated dynamically from movements
- All currency displayed in Indian Rupee (₹)

### Docker Deployment

1. **Using Docker Compose (Recommended)**
   ```bash
   docker-compose up --build
   ```

2. **Access Application**
   - Main app: http://localhost:8000/

3. **Create Superuser in Docker**
   ```bash
   docker-compose exec web python manage.py createsuperuser
   ```

**Note:** The Docker setup now uses SQLite for a lightweight deployment. The database file is persisted as a volume, so your data will be saved between container restarts.

### Manual Docker Build
```bash
docker build -t invoice-app .
docker run -p 8000:8000 invoice-app
```

## Usage Guide

### User Authentication & Management
1. **Login**: Navigate to `/accounts/login/`
2. **First-Time Login**: New users created by admin must change password on first login
3. **Change Password**: Access via navigation menu or `/change-password/`
4. **Admin User Management** (Staff only):
   - Create users with default password: `Welcome@123`
   - Reset user passwords
   - Enable/disable user accounts
   - Delete users (cannot delete self)

### Invoice Management
1. **Create Invoice**: 
   - Select product from dropdown
   - Enter client name and quantity
   - Invoice number auto-generated (INV-YYYYMMDD-XXXX)
   - Invoice date defaults to today
   - Unit price automatically pulled from product

2. **View Invoices**: 
   - Regular users: See only their own invoices
   - Admin users: See all invoices with filters (user and date range)
   - Click invoice to view details or print

3. **Print Invoice**: 
   - Rupee (₹) currency symbol
   - Clean layout for printing

### Product Management
1. **View Products** (All users):
   - Navigate to "Products" in menu
   - See all products with current stock levels
   
2. **Manage Products** (Admin only):
   - Create new products (name, description, unit, price)
   - Edit existing products
   - Delete products
   - Activate/deactivate products
   - Note: Stock quantities managed via Inventory

### Inventory Management
1. **View Inventory** (All users):
   - Navigate to "Inventory" in menu
   - See current stock levels (color-coded)
   - View recent stock movements
   - View product stock history

2. **Manage Stock** (Admin only):
   - Add incoming stock (purchases, returns)
   - Record outgoing stock (damage, samples, etc.)
   - Add movement date and notes
   - Track who made each movement

3. **Stock Calculation**:
   - Current Stock = Incoming Stock - Outgoing Stock - Invoice Sales
   - All movements tracked with full audit trail
   - Running totals shown in history view

### Access Control
- **All Users**: View products, inventory, create invoices, change password
- **Admin/Staff**: All user features PLUS:
  - Create/edit/delete products
  - Add stock movements
  - Manage users
  - View all invoices with filters

### Design Philosophy
- **Minimalist**: Clean black and white design
- **Indian Currency**: Rupee (₹) symbol throughout
- **Print-Optimized**: Invoice templates for printing
- **Audit Trail**: Complete history of all stock movements
- **Real-time Stock**: Dynamically calculated from movements

## Configuration

### Environment Variables
```bash
# Django Settings
DEBUG=1                    # Set to 0 for production
SECRET_KEY=your-secret-key
```

### Django Settings

#### External Access (IPv6)
```python
# settings.py
ALLOWED_HOSTS = ['*']  # Development only - allows external IPv6 access
# Production: ALLOWED_HOSTS = ['yourdomain.com', 'your-ipv6-address']
```

**Start Server for External Access:**
```bash
python manage.py runserver 0.0.0.0:8000
# Access via: http://[YOUR_IPV6_ADDRESS]:8000/
```

#### Middleware Configuration
```python
MIDDLEWARE = [
    # ... other middleware ...
    'invoices.middleware.PasswordChangeMiddleware',  # Enforces password change
]
```

### Business Rules

#### Default Credentials
- Admin-created users: Password `Welcome@123`
- Must change password on first login

#### Stock Calculation Formula
```
Current Stock = Incoming Stock - Outgoing Stock - Invoice Sales
```

#### Invoice Numbering
- Format: `INV-YYYYMMDD-XXXX`
- Auto-generated sequential numbers per day

#### Tax Calculation
- Tax Rate: 10%
- Subtotal = quantity × unit_price
- Tax = subtotal × 0.1
- Total = subtotal + tax

### Settings Overview
- **Database**: SQLite (lightweight, suitable for small-medium apps)
- **Currency**: Indian Rupee (₹)
- **Authentication**: Django built-in with custom templates
- **Static Files**: Served by development server (collect for production)

## Security Features

### Authentication & Authorization
- Django built-in authentication system
- Role-based access control:
  - **Regular Users**: View products/inventory, create invoices, change password
  - **Admin/Staff**: All features + user management, product editing, stock movements
- Forced password change on first login via middleware
- Session preservation after password change

### Security Protections
- CSRF protection on all forms
- User authentication required for all operations
- SQL injection protection through Django ORM
- XSS protection through template escaping
- Secure password hashing (Django defaults)

### Audit Trail
- Complete stock movement history:
  - User who created each movement
  - Timestamp
  - Movement type (IN/OUT) and quantity
  - Optional notes
- Product stock history with running totals

## Customization

### Adding New Fields
1. Update `models.py` to add new fields
2. Create and run migrations: `python manage.py makemigrations && python manage.py migrate`
3. Update forms in `forms.py`
4. Modify templates as needed

### Styling Changes
- Main styles are in `templates/base.html` `<style>` section
- Print styles use `@media print` queries
- Color scheme is black and white for professional printing

### Business Logic Customization
- Tax rate: Modify `Invoice.tax_amount` property in `models.py`
- Stock calculation: Adjust `Product.quantity_in_stock` property
- Invoice numbering format: Edit `Invoice.save()` method
- Default password: Change `create_user` view in `views.py`
- Low stock threshold: Modify `inventory_management` view (currently 10)

### Stock Movement Tracking
- Movement types defined in `StockMovement.MOVEMENT_TYPES`
- Add new types by updating choices tuple
- Extend with additional fields (location, batch number, etc.)

## Dependencies

### Dependencies
```
Django==5.2.7
asgiref==3.9.2
sqlparse==0.5.3
```

### Development Tools
- SQLite (built into Python)
- Django development server
- Django admin interface

## Deployment Notes

### Production Checklist
- [ ] Set `DEBUG=False` in settings
- [ ] Configure proper `SECRET_KEY` (use environment variable)
- [ ] Update `ALLOWED_HOSTS` with specific domains/IPs
- [ ] Set up PostgreSQL/MySQL database (optional, SQLite works for small-medium apps)
- [ ] Configure static file serving (nginx/Apache)
- [ ] Set up SSL/HTTPS
- [ ] Configure proper logging
- [ ] Set up backup strategy for database
- [ ] Review and secure IPv6 access settings

### Scaling Considerations
- **Database**: SQLite suitable for small-medium applications; PostgreSQL for larger scale
- **Static Files**: Serve via web server (nginx) or CDN
- **Application**: Can be scaled horizontally with multiple containers/processes
- **Caching**: Consider Redis for session storage if needed
- **Stock Calculation**: Dynamic queries may impact performance at scale; consider caching

### Docker Deployment
- Dockerfile included for containerization
- docker-compose.yml configured for easy deployment
- PostgreSQL service defined for production database

## Troubleshooting

### Common Issues
1. **Database Connection**: Check DATABASE_URL and credentials
2. **Static Files**: Run `python manage.py collectstatic`
3. **Migrations**: Run `python manage.py migrate` after model changes
4. **Permissions**: Ensure user has permissions to create invoices

### Docker Issues
1. **Build Fails**: Check Dockerfile syntax and base image
2. **Database Connection**: Ensure PostgreSQL service is running
3. **Port Conflicts**: Change port mapping in docker-compose.yml

## Future Enhancements

### Potential Features
- [ ] Multiple line items per invoice
- [ ] PDF generation (using ReportLab or WeasyPrint)
- [ ] Email invoice sending
- [ ] Payment tracking and reconciliation
- [ ] Invoice templates and customization
- [ ] Recurring invoices
- [ ] Client management interface with full contact details
- [ ] Supplier management for incoming stock
- [ ] Purchase orders
- [ ] Stock alerts via email/notifications
- [ ] Barcode/QR code support for products
- [ ] Reports and analytics dashboard
- [ ] Export to Excel/CSV
- [ ] Multi-currency support
- [ ] GST/Tax compliance features
- [ ] Batch operations for stock movements
- [ ] Reporting and analytics
- [ ] API endpoints
- [ ] Multi-currency support

### Technical Improvements
- [ ] Add comprehensive tests
- [ ] Implement caching
- [ ] Add logging
- [ ] API documentation
- [ ] Performance optimization
- [ ] Multi-language support

## Support & Maintenance

### Backup Strategy
- Database: Regular PostgreSQL backups
- Files: Backup entire project directory
- Docker: Use volume backups for persistent data

### Monitoring
- Application logs via Django logging
- Database performance monitoring
- Docker container health checks

### Updates
- Regularly update Django and dependencies
- Monitor security advisories
- Test updates in staging environment

---

**Last Updated:** October 2025  
**Django Version:** 5.2.7  
**Status:** Production Ready  
**Environment:** Dockerized Application